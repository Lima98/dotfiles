"use strict";var Ne=Object.create;var N=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var Ae=Object.getPrototypeOf,Ve=Object.prototype.hasOwnProperty;var l=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),De=(r,e)=>{for(var s in e)N(r,s,{get:e[s],enumerable:!0})},z=(r,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Pe(e))!Ve.call(r,a)&&a!==s&&N(r,a,{get:()=>e[a],enumerable:!(t=ve(e,a))||t.enumerable});return r};var _=(r,e,s)=>(s=r!=null?Ne(Ae(r)):{},z(e||!r||!r.__esModule?N(s,"default",{value:r,enumerable:!0}):s,r)),Te=r=>z(N({},"__esModule",{value:!0}),r);var D=l((wt,U)=>{"use strict";var{Readable:yt,Writable:xt,Duplex:je,Transform:W}=require("stream"),Oe=Symbol.for("object-stream.none"),A=Symbol.for("object-stream.final"),V=Symbol.for("object-stream.many"),Me=r=>({[A]:r}),Fe=r=>({[V]:r}),Ie=r=>r&&typeof r=="object"&&A in r,$e=r=>r&&typeof r=="object"&&V in r,Ke=r=>r[A],Le=r=>r[V],Re=async(r,e)=>{for(;;){let s=r.next();if(s&&typeof s.then=="function"&&(s=await s),s.done)break;let t=s.value;t&&typeof t.then=="function"&&(t=await t),c.sanitize(t,e)}},qe=r=>new W({writableObjectMode:!0,readableObjectMode:!0,transform(e,s,t){try{let a=r.call(this,e,s);if(a&&typeof a.then=="function"){a.then(n=>(c.sanitize(n,this),t(null)),n=>t(n));return}if(a&&typeof a.next=="function"){Re(a,this).then(()=>t(null),n=>t(n));return}c.sanitize(a,this),t(null)}catch(a){t(a)}}}),ze=r=>new W({writableObjectMode:!0,readableObjectMode:!0,transform(e,s,t){try{let a=e;for(let n=0;n<r.length;++n){let u=r[n].call(this,a,s);if(u===c.none){t(null);return}if(c.isFinal(u)){a=c.getFinalValue(u);break}a=u}c.sanitize(a,this),t(null)}catch(a){t(a)}}}),B=r=>r&&typeof r.pipe=="function"&&typeof r.on=="function"&&(!r._writableState||(typeof r._readableState=="object"?r._readableState.readable:null)!==!1)&&(!r._writableState||r._readableState),H=r=>r&&typeof r.write=="function"&&typeof r.on=="function"&&(!r._readableState||(typeof r._writableState=="object"?r._writableState.writable:null)!==!1),Be=r=>r&&typeof r.pipe=="function"&&r._readableState&&typeof r.on=="function"&&typeof r.write=="function",c=class r extends je{constructor(e,s){if(super(s||{writableObjectMode:!0,readableObjectMode:!0}),!(e instanceof Array)||!e.length)throw Error("Chain's argument should be a non-empty array.");this.streams=e.filter(t=>t).map((t,a,n)=>{if(typeof t=="function"||t instanceof Array)return r.convertToTransform(t);if(Be(t)||!a&&B(t)||a===n.length-1&&H(t))return t;throw Error("Arguments should be functions, arrays or streams.")}).filter(t=>t),this.input=this.streams[0],this.output=this.streams.reduce((t,a)=>t&&t.pipe(a)||a),H(this.input)||(this._write=(t,a,n)=>n(null),this._final=t=>t(null),this.input.on("end",()=>this.end())),B(this.output)?(this.output.on("data",t=>!this.push(t)&&this.output.pause()),this.output.on("end",()=>this.push(null))):(this._read=()=>{},this.resume(),this.output.on("finish",()=>this.push(null))),(!s||!s.skipEvents)&&this.streams.forEach(t=>t.on("error",a=>this.emit("error",a)))}_write(e,s,t){let a=null;try{this.input.write(e,s,n=>t(n||a))}catch(n){a=n}}_final(e){let s=null;try{this.input.end(null,null,t=>e(t||s))}catch(t){s=t}}_read(){this.output.resume()}static make(e,s){return new r(e,s)}static sanitize(e,s){r.isFinal(e)?e=r.getFinalValue(e):r.isMany(e)&&(e=r.getManyValues(e)),e!=null&&e!==r.none&&(e instanceof Array?e.forEach(t=>t!=null&&s.push(t)):s.push(e))}static convertToTransform(e){return typeof e=="function"?qe(e):e instanceof Array&&e.length?ze(e):null}};c.none=Oe;c.final=Me;c.isFinal=Ie;c.getFinalValue=Ke;c.many=Fe;c.isMany=$e;c.getManyValues=Le;c.chain=c.make;c.make.Constructor=c;U.exports=c});var Z=l((St,J)=>{"use strict";var{Transform:He}=require("stream"),{StringDecoder:We}=require("string_decoder"),T=class extends He{constructor(e){super(Object.assign({},e,{writableObjectMode:!1})),this._buffer=""}_transform(e,s,t){typeof e=="string"?this._transform=this._transformString:(this._stringDecoder=new We,this._transform=this._transformBuffer),this._transform(e,s,t)}_transformBuffer(e,s,t){this._buffer+=this._stringDecoder.write(e),this._processBuffer(t)}_transformString(e,s,t){this._buffer+=e.toString(),this._processBuffer(t)}_processBuffer(e){this._buffer&&(this.push(this._buffer,"utf8"),this._buffer=""),e(null)}_flushInput(){this._stringDecoder&&(this._buffer+=this._stringDecoder.end())}_flush(e){this._flushInput(),this._processBuffer(e)}};J.exports=T});var j=l((Et,G)=>{"use strict";var Ue=Z(),i={value1:/^(?:[\"\{\[\]\-\d]|true\b|false\b|null\b|\s{1,256})/,string:/^(?:[^\x00-\x1f\"\\]{1,256}|\\[bfnrt\"\\\/]|\\u[\da-fA-F]{4}|\")/,key1:/^(?:[\"\}]|\s{1,256})/,colon:/^(?:\:|\s{1,256})/,comma:/^(?:[\,\]\}]|\s{1,256})/,ws:/^\s{1,256}/,numberStart:/^\d/,numberDigit:/^\d{0,256}/,numberFraction:/^[\.eE]/,numberExponent:/^[eE]/,numberExpSign:/^[-+]/},Je=16,o=!0;try{new RegExp(".","y"),o=!1}catch{}!o&&Object.keys(i).forEach(r=>{let e=i[r].source.slice(1);e.slice(0,3)==="(?:"&&e.slice(-1)===")"&&(e=e.slice(3,-1)),i[r]=new RegExp(e,"y")});i.numberFracStart=i.numberExpStart=i.numberStart;i.numberFracDigit=i.numberExpDigit=i.numberDigit;var Ze={true:!0,false:!1,null:null},f={object:"objectStop",array:"arrayStop","":"done"},Ge=r=>String.fromCharCode(parseInt(r.slice(2),16)),Xe={b:"\b",f:"\f",n:`
`,r:"\r",t:"	",'"':'"',"\\":"\\","/":"/"},b=class r extends Ue{static make(e){return new r(e)}constructor(e){super(Object.assign({},e,{readableObjectMode:!0})),this._packKeys=this._packStrings=this._packNumbers=this._streamKeys=this._streamStrings=this._streamNumbers=!0,e&&("packValues"in e&&(this._packKeys=this._packStrings=this._packNumbers=e.packValues),"packKeys"in e&&(this._packKeys=e.packKeys),"packStrings"in e&&(this._packStrings=e.packStrings),"packNumbers"in e&&(this._packNumbers=e.packNumbers),"streamValues"in e&&(this._streamKeys=this._streamStrings=this._streamNumbers=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys),"streamStrings"in e&&(this._streamStrings=e.streamStrings),"streamNumbers"in e&&(this._streamNumbers=e.streamNumbers),this._jsonStreaming=e.jsonStreaming),!this._packKeys&&(this._streamKeys=!0),!this._packStrings&&(this._streamStrings=!0),!this._packNumbers&&(this._streamNumbers=!0),this._done=!1,this._expect=this._jsonStreaming?"done":"value",this._stack=[],this._parent="",this._open_number=!1,this._accumulator=""}_flush(e){this._done=!0,super._flush(s=>{if(s)return e(s);this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),e(null)})}_processBuffer(e){let s,t,a=0;e:for(;;)switch(this._expect){case"value1":case"value":if(i.value1.lastIndex=a,s=i.value1.exec(this._buffer),!s){if(this._done||a+Je<this._buffer.length)return a<this._buffer.length?e(new Error("Parser cannot parse input: expected a value")):e(new Error("Parser has expected a value"));break e}switch(t=s[0],t){case'"':this._streamStrings&&this.push({name:"startString"}),this._expect="string";break;case"{":this.push({name:"startObject"}),this._stack.push(this._parent),this._parent="object",this._expect="key1";break;case"[":this.push({name:"startArray"}),this._stack.push(this._parent),this._parent="array",this._expect="value1";break;case"]":if(this._expect!=="value1")return e(new Error("Parser cannot parse input: unexpected token ']'"));this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),this.push({name:"endArray"}),this._parent=this._stack.pop(),this._expect=f[this._parent];break;case"-":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"-"})),this._packNumbers&&(this._accumulator="-"),this._expect="numberStart";break;case"0":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"0"})),this._packNumbers&&(this._accumulator="0"),this._expect="numberFraction";break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:t})),this._packNumbers&&(this._accumulator=t),this._expect="numberDigit";break;case"true":case"false":case"null":if(this._buffer.length-a===t.length&&!this._done)break e;this.push({name:t+"Value",value:Ze[t]}),this._expect=f[this._parent];break}o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"keyVal":case"string":if(i.string.lastIndex=a,s=i.string.exec(this._buffer),!s){if(a<this._buffer.length&&(this._done||this._buffer.length-a>=6))return e(new Error("Parser cannot parse input: escaped characters"));if(this._done)return e(new Error("Parser has expected a string value"));break e}if(t=s[0],t==='"')this._expect==="keyVal"?(this._streamKeys&&this.push({name:"endKey"}),this._packKeys&&(this.push({name:"keyValue",value:this._accumulator}),this._accumulator=""),this._expect="colon"):(this._streamStrings&&this.push({name:"endString"}),this._packStrings&&(this.push({name:"stringValue",value:this._accumulator}),this._accumulator=""),this._expect=f[this._parent]);else if(t.length>1&&t.charAt(0)==="\\"){let n=t.length==2?Xe[t.charAt(1)]:Ge(t);(this._expect==="keyVal"?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:n}),(this._expect==="keyVal"?this._packKeys:this._packStrings)&&(this._accumulator+=n)}else(this._expect==="keyVal"?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:t}),(this._expect==="keyVal"?this._packKeys:this._packStrings)&&(this._accumulator+=t);o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"key1":case"key":if(i.key1.lastIndex=a,s=i.key1.exec(this._buffer),!s){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an object key"));break e}if(t=s[0],t==='"')this._streamKeys&&this.push({name:"startKey"}),this._expect="keyVal";else if(t==="}"){if(this._expect!=="key1")return e(new Error("Parser cannot parse input: unexpected token '}'"));this.push({name:"endObject"}),this._parent=this._stack.pop(),this._expect=f[this._parent]}o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"colon":if(i.colon.lastIndex=a,s=i.colon.exec(this._buffer),!s){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ':'"));break e}t=s[0],t===":"&&(this._expect="value"),o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"arrayStop":case"objectStop":if(i.comma.lastIndex=a,s=i.comma.exec(this._buffer),!s){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ','"));break e}if(this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),t=s[0],t===",")this._expect=this._expect==="arrayStop"?"value":"key";else if(t==="}"||t==="]"){if(t==="}"?this._expect==="arrayStop":this._expect!=="arrayStop")return e(new Error("Parser cannot parse input: expected '"+(this._expect==="arrayStop"?"]":"}")+"'"));this.push({name:t==="}"?"endObject":"endArray"}),this._parent=this._stack.pop(),this._expect=f[this._parent]}o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberStart":if(i.numberStart.lastIndex=a,s=i.numberStart.exec(this._buffer),!s){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a starting digit"));break e}t=s[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect=t==="0"?"numberFraction":"numberDigit",o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberDigit":if(i.numberDigit.lastIndex=a,s=i.numberDigit.exec(this._buffer),!s){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a digit"));break e}if(t=s[0],t)this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),o?this._buffer=this._buffer.slice(t.length):a+=t.length;else{if(a<this._buffer.length){this._expect="numberFraction";break}if(this._done){this._expect=f[this._parent];break}break e}break;case"numberFraction":if(i.numberFraction.lastIndex=a,s=i.numberFraction.exec(this._buffer),!s){if(a<this._buffer.length||this._done){this._expect=f[this._parent];break}break e}t=s[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect=t==="."?"numberFracStart":"numberExpSign",o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberFracStart":if(i.numberFracStart.lastIndex=a,s=i.numberFracStart.exec(this._buffer),!s){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a fractional part of a number"));break e}t=s[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberFracDigit",o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberFracDigit":if(i.numberFracDigit.lastIndex=a,s=i.numberFracDigit.exec(this._buffer),t=s[0],t)this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),o?this._buffer=this._buffer.slice(t.length):a+=t.length;else{if(a<this._buffer.length){this._expect="numberExponent";break}if(this._done){this._expect=f[this._parent];break}break e}break;case"numberExponent":if(i.numberExponent.lastIndex=a,s=i.numberExponent.exec(this._buffer),!s){if(a<this._buffer.length){this._expect=f[this._parent];break}if(this._done){this._expect="done";break}break e}t=s[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberExpSign",o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberExpSign":if(i.numberExpSign.lastIndex=a,s=i.numberExpSign.exec(this._buffer),!s){if(a<this._buffer.length){this._expect="numberExpStart";break}if(this._done)return e(new Error("Parser has expected an exponent value of a number"));break e}t=s[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberExpStart",o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberExpStart":if(i.numberExpStart.lastIndex=a,s=i.numberExpStart.exec(this._buffer),!s){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an exponent part of a number"));break e}t=s[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberExpDigit",o?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberExpDigit":if(i.numberExpDigit.lastIndex=a,s=i.numberExpDigit.exec(this._buffer),t=s[0],t)this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),o?this._buffer=this._buffer.slice(t.length):a+=t.length;else{if(a<this._buffer.length||this._done){this._expect=f[this._parent];break}break e}break;case"done":if(i.ws.lastIndex=a,s=i.ws.exec(this._buffer),!s){if(a<this._buffer.length){if(this._jsonStreaming){this._expect="value";break}return e(new Error("Parser cannot parse input: unexpected characters"))}break e}t=s[0],this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),o?this._buffer=this._buffer.slice(t.length):a+=t.length;break}!o&&(this._buffer=this._buffer.slice(a)),e(null)}};b.parser=b.make;b.make.Constructor=b;G.exports=b});var Q=l((Ct,X)=>{"use strict";var Qe=r=>r.on("data",e=>r.emit(e.name,e.value));X.exports=Qe});var ee=l((Nt,Y)=>{"use strict";var O=j(),Ye=Q(),M=r=>Ye(new O(r));M.Parser=O;M.parser=O.parser;Y.exports=M});var se=l((vt,te)=>{"use strict";var{Transform:et}=require("stream"),p=class r extends et{static stringFilter(e,s){return t=>{let a=t.join(s);return a.length===e.length&&a===e||a.length>e.length&&a.substr(0,e.length)===e&&a.substr(e.length,s.length)===s}}static regExpFilter(e,s){return t=>e.test(t.join(s))}static arrayReplacement(e){return()=>e}constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),this._transform=this._check,this._stack=[];let s=e&&e.filter,t=e&&e.pathSeparator||".";typeof s=="string"?this._filter=r.stringFilter(s,t):typeof s=="function"?this._filter=s:s instanceof RegExp&&(this._filter=r.regExpFilter(s,t));let a=e&&e.replacement;typeof a=="function"?this._replacement=a:this._replacement=r.arrayReplacement(a||r.defaultReplacement),this._allowEmptyReplacement=e&&e.allowEmptyReplacement,this._streamKeys=!0,e&&("streamValues"in e&&(this._streamKeys=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys)),this._once=e&&e.once,this._previousToken=""}_check(e,s,t){switch(e.name){case"startObject":case"startArray":case"startString":case"startNumber":case"nullValue":case"trueValue":case"falseValue":typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break;case"keyValue":this._stack[this._stack.length-1]=e.value;break;case"numberValue":this._previousToken!=="endNumber"&&typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break;case"stringValue":this._previousToken!=="endString"&&typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break}if(this._previousToken=e.name,this._checkChunk(e))return t(null);switch(e.name){case"startObject":this._stack.push(null);break;case"startArray":this._stack.push(-1);break;case"endObject":case"endArray":this._stack.pop();break}t(null)}_passObject(e,s,t){switch(this.push(e),e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth;break}this._depth||(this._transform=this._once?this._skip:this._check),t(null)}_pass(e,s,t){this.push(e),t(null)}_skipObject(e,s,t){switch(e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth;break}this._depth||(this._transform=this._once?this._pass:this._check),t(null)}_skip(e,s,t){t(null)}};p.defaultReplacement=[{name:"nullValue",value:null}];var F=(r,e)=>function(s,t,a){if(this._expected){let n=this._expected;if(this._expected="",this._transform=this._once?this._skip:this._check,n===s.name)this.push(s);else return this._transform(s,t,a)}else this.push(s),s.name===r&&(this._expected=e);a(null)};p.prototype._passNumber=F("endNumber","numberValue");p.prototype._passString=F("endString","stringValue");p.prototype._passKey=F("endKey","keyValue");var I=(r,e)=>function(s,t,a){if(this._expected){let n=this._expected;if(this._expected="",this._transform=this._once?this._pass:this._check,n!==s.name)return this._transform(s,t,a)}else s.name===r&&(this._expected=e);a(null)};p.prototype._skipNumber=I("endNumber","numberValue");p.prototype._skipString=I("endString","stringValue");p.prototype._skipKey=I("endKey","keyValue");te.exports=p});var $=l((Pt,re)=>{"use strict";var{chain:tt}=D(),st=j(),rt=(r,e)=>tt([new st(e),r(e)],Object.assign({},e,{writableObjectMode:!1,readableObjectMode:!0}));re.exports=rt});var ne=l((At,ae)=>{"use strict";var at=se(),nt=$(),g=class r extends at{static make(e){return new r(e)}static withParser(e){return nt(r.make,e)}constructor(e){super(e),this._once=!1,this._lastStack=[]}_flush(e){this._syncStack(),e(null)}_checkChunk(e){switch(e.name){case"startObject":this._filter(this._stack,e)&&(this._syncStack(),this.push(e),this._lastStack.push(null));break;case"startArray":this._filter(this._stack,e)&&(this._syncStack(),this.push(e),this._lastStack.push(-1));break;case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":this._filter(this._stack,e)&&(this._syncStack(),this.push(e));break;case"startString":this._filter(this._stack,e)?(this._syncStack(),this.push(e),this._transform=this._passString):this._transform=this._skipString;break;case"startNumber":this._filter(this._stack,e)?(this._syncStack(),this.push(e),this._transform=this._passNumber):this._transform=this._skipNumber;break}return!1}_syncStack(){let e=this._stack,s=this._lastStack,t=e.length,a=s.length,n=0;for(let u=Math.min(t,a);n<u&&e[n]===s[n];++n);for(let u=a-1;u>n;--u)this.push({name:typeof s[u]=="number"?"endArray":"endObject"});if(n<a)if(n<t){if(typeof e[n]=="string"){let u=e[n];this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:u}),this.push({name:"endKey"})),this.push({name:"keyValue",value:u})}++n}else this.push({name:typeof s[n]=="number"?"endArray":"endObject"});for(let u=n;u<t;++u){let C=e[u];typeof C=="number"?C>=0&&this.push({name:"startArray"}):typeof C=="string"&&(this.push({name:"startObject"}),this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:C}),this.push({name:"endKey"})),this.push({name:"keyValue",value:C}))}this._lastStack=Array.prototype.concat.call(e)}};g.filter=g.make;g.make.Constructor=g;ae.exports=g});var oe=l((Vt,ce)=>{"use strict";var it=require("events"),ie=r=>function(){this.done?this.done=!1:this.stack.push(this.current,this.key),this.current=new r,this.key=null},d=class r extends it{static connectTo(e,s){return new r(s).connectTo(e)}constructor(e){super(),this.stack=[],this.current=this.key=null,this.done=!0,e&&(this.reviver=typeof e.reviver=="function"&&e.reviver,this.reviver&&(this.stringValue=this._saveValue=this._saveValueWithReviver),e.numberAsString&&(this.numberValue=this.stringValue))}connectTo(e){return e.on("data",s=>{this[s.name]&&(this[s.name](s.value),this.done&&this.emit("done",this))}),this}get depth(){return(this.stack.length>>1)+(this.done?0:1)}get path(){let e=[];for(let s=0;s<this.stack.length;s+=2){let t=this.stack[s+1];e.push(t===null?this.stack[s].length:t)}return e}dropToLevel(e){if(e<this.depth)if(e){let s=e-1<<1;this.current=this.stack[s],this.key=this.stack[s+1],this.stack.splice(s)}else this.stack=[],this.current=this.key=null,this.done=!0;return this}consume(e){return this[e.name]&&this[e.name](e.value),this}keyValue(e){this.key=e}numberValue(e){this._saveValue(parseFloat(e))}nullValue(){this._saveValue(null)}trueValue(){this._saveValue(!0)}falseValue(){this._saveValue(!1)}endObject(){if(this.stack.length){let e=this.current;this.key=this.stack.pop(),this.current=this.stack.pop(),this._saveValue(e)}else this.done=!0}_saveValue(e){this.done?this.current=e:this.current instanceof Array?this.current.push(e):(this.current[this.key]=e,this.key=null)}_saveValueWithReviver(e){this.done?this.current=this.reviver("",e):this.current instanceof Array?(e=this.reviver(""+this.current.length,e),this.current.push(e),e===void 0&&delete this.current[this.current.length-1]):(e=this.reviver(this.key,e),e!==void 0&&(this.current[this.key]=e),this.key=null)}};d.prototype.stringValue=d.prototype._saveValue;d.prototype.startObject=ie(Object);d.prototype.startArray=ie(Array);d.prototype.endArray=d.prototype.endObject;ce.exports=d});var he=l((Dt,ue)=>{"use strict";var{Transform:ct}=require("stream"),ot=oe(),K=class{constructor(e){this.depth=e}startObject(){++this.depth}endObject(){--this.depth}startArray(){++this.depth}endArray(){--this.depth}},L=class extends ct{constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),e&&(this.objectFilter=e.objectFilter,this.includeUndecided=e.includeUndecided),typeof this.objectFilter!="function"&&(this._filter=this._transform),this._transform=this._wait||this._filter,this._assembler=new ot(e)}_transform(e,s,t){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&this._push()),t(null)}_filter(e,s,t){if(this._assembler[e.name]){this._assembler[e.name](e.value);let a=this.objectFilter(this._assembler);if(a)return this._assembler.depth===this._level&&(this._push(),this._transform=this._filter),this._transform=this._accept,t(null);if(a===!1)return this._saved_assembler=this._assembler,this._assembler=new K(this._saved_assembler.depth),this._saved_assembler.dropToLevel(this._level),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter),this._transform=this._reject,t(null);this._assembler.depth===this._level&&this._push(!this.includeUndecided)}t(null)}_accept(e,s,t){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._push(),this._transform=this._filter)),t(null)}_reject(e,s,t){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter)),t(null)}};ue.exports=L});var fe=l((Tt,le)=>{"use strict";var ut=he(),ht=$(),k=class r extends ut{static make(e){return new r(e)}static withParser(e){return ht(r.make,e)}constructor(e){super(e),this._level=1,this._counter=0}_wait(e,s,t){return e.name!=="startArray"?t(new Error("Top-level object should be an array.")):(this._transform=this._filter,this._transform(e,s,t))}_push(e){this._assembler.current.length&&(e?(++this._counter,this._assembler.current.pop()):this.push({key:this._counter++,value:this._assembler.current.pop()}))}};k.streamArray=k.make;k.make.Constructor=k;le.exports=k});var q=l(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.redactString=R;v.sanitizeArgs=lt;function pe(r){return r.replace(/([A-Za-z0-9._%+-])[^@\s]*(@[A-Za-z0-9.-]+\.[A-Za-z]{2,})/g,(e,s,t)=>`${s}***${t}`)}function R(r){let e=r;return e=e.replace(/bearer\s+[^\s"']+/gi,"Bearer ***"),e=e.replace(/(password|pass|pwd|secret|token|auth|authorization|key)\s*[:=]\s*[^\s&"']+/gi,"$1=***"),e=e.replace(/((?:code|2fa|two[-\s]?factor|otp)\s*[:=\s]+)(\d{4,8})/gi,(s,t)=>`${t}******`),e=e.replace(/[a-f0-9]{32,}/gi,"***"),e=e.replace(/[A-Za-z0-9+/]{20,}={0,2}/g,"***"),e=pe(e),e}function me(r,e){let s=r.toLowerCase();if(e==null)return e;if(typeof e=="string")return["password","pass","pwd","secret","token","auth","authorization","applepassword"].includes(s)?"***":["code","otp","2fa","twofactor","two_factor"].includes(s)?"******":["email","appleid","apple_id","username","user"].includes(s)?pe(e):R(e);if(typeof e=="number")return["code","otp","2fa"].includes(s)?0:e;if(typeof e=="object")try{let t=JSON.stringify(e,(a,n)=>me(a,n));return JSON.parse(t)}catch{return e}return e}function lt(r){return r.map(e=>{if(typeof e=="string")return R(e);if(typeof e=="object"&&e!==null)try{let s=JSON.stringify(e,(t,a)=>me(t,a));return JSON.parse(s)}catch{return e}return e})}});var _e=l(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.logger=w.Logger=void 0;var ft=require("@raycast/api"),de=q(),P=class r{constructor(e={}){this.config={isVerboseEnabled:e.isVerboseEnabled||this.defaultVerboseCheck,prefix:e.prefix||"",enableRedaction:e.enableRedaction??!0}}defaultVerboseCheck(){try{return(0,ft.getPreferenceValues)().verboseLogging||!1}catch(e){return console.error("[Logger] Failed to read preferences for verbose logging:",e),!1}}static getInstance(){return r.instance||(r.instance=new r),r.instance}formatMessage(e){return this.config.prefix?`${this.config.prefix} ${e}`:e}processLogData(e,s){let t=this.formatMessage(e);return this.config.enableRedaction?[(0,de.redactString)(t),(0,de.sanitizeArgs)(s)]:[t,s]}log(e,...s){if(this.config.isVerboseEnabled()){let[t,a]=this.processLogData(e,s);console.log(t,...a)}}error(e,...s){let[t,a]=this.processLogData(e,s);console.error(t,...a)}warn(e,...s){let[t,a]=this.processLogData(e,s);console.warn(t,...a)}child(e){let s=this.config.prefix?`${this.config.prefix} ${e}`:e;return new r({...this.config,prefix:s})}};w.Logger=P;w.logger=P.getInstance()});var ke=l(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.sanitizeArgs=m.redactString=m.logger=m.Logger=void 0;var be=_e();Object.defineProperty(m,"Logger",{enumerable:!0,get:function(){return be.Logger}});Object.defineProperty(m,"logger",{enumerable:!0,get:function(){return be.logger}});var ge=q();Object.defineProperty(m,"redactString",{enumerable:!0,get:function(){return ge.redactString}});Object.defineProperty(m,"sanitizeArgs",{enumerable:!0,get:function(){return ge.sanitizeArgs}})});var gt={};De(gt,{default:()=>Ce});module.exports=Te(gt);var h=require("@raycast/api"),E=_(require("path")),Se=_(require("fs")),x=require("fs/promises"),Ee=require("fs/promises");var mt=_(D()),dt=_(ee()),_t=_(ne()),bt=_(fe());var ye=_(ke()),S=new ye.Logger({prefix:"[Brew]"}),Ft=S.child("[Commands]"),y=S.child("[Cache]"),It=S.child("[Actions]"),pt=S.child("[Fetch]"),$t=S.child("[Search]"),Kt=S.child("[UI]");function xe(r){return r instanceof Error?r:new Error(String(r))}var Wt=(()=>{try{Se.default.mkdirSync(h.environment.supportPath,{recursive:!0})}catch{y.warn("Failed to create supportPath")}return h.environment.supportPath})(),Ut=h.environment.supportPath.split(E.default.sep).find(r=>!!r.startsWith("com.raycast"))??"com.raycast.macos";var we=["formula.json","cask.json","installedv2.json"];async function Ce(){try{y.log("Starting cache clear operation"),await(0,h.showToast)(h.Toast.Style.Animated,"Clearing downloaded casks and formulae...");let r=[],e={};for(let s of we){let t=E.default.join(h.environment.supportPath,s);try{let a=await(0,Ee.stat)(t);r.push(s),e[s]=a.size}catch{}}r.length>0?y.log("Clearing cache files",{files:r,sizes:e,totalBytes:Object.values(e).reduce((s,t)=>s+t,0)}):y.log("No cache files to clear"),await Promise.all([...we.map(s=>(0,x.rm)(E.default.join(h.environment.supportPath,s),{force:!0}).catch(()=>{})),(0,x.rm)(E.default.join(h.environment.supportPath,"formula"),{recursive:!0,force:!0}).catch(()=>{}),(0,x.rm)(E.default.join(h.environment.supportPath,"cask"),{recursive:!0,force:!0}).catch(()=>{})]),y.log("Cache clear completed",{filesCleared:r,fileCount:r.length}),await(0,h.showToast)(h.Toast.Style.Success,"Cache files cleared")}catch(r){let e=xe(r);y.error("Failed to clear cache",{error:e.message}),await(0,h.showToast)(h.Toast.Style.Failure,"Failed to clear cache",e.message)}}
